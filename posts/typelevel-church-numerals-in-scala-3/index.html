<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=http://raasahsan.com/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>Typelevel Church Numerals in Scala 3</title></head><body><header id=banner><h2><a href=http://raasahsan.com>Raas Ahsan</a></h2><nav><ul><li><a href=/ title=posts>posts</a></li><li><a href=/links/ title=links>links</a></li><li><a href=https://github.com/RaasAhsan title=github>github</a></li></ul></nav></header><main id=content><article><header id=post-header><h1>Typelevel Church Numerals in Scala 3</h1><time>February 28, 2021</time></header><p>Modeling church numerals as functions in most languages is straightforward.
Scala&rsquo;s type system is powerful enough that we can represent them <em>and</em> express
computation with them directly in the type system!</p><p>The definitions in Scala follow immediately from the definitions in the untyped
lambda calculus; functions in the latter correspond to typelevel functions in
the former.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>ChurchNumerals</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>{</span>

  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>zero</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> z
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>succ</span><span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> s<span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]]</span>

  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>one</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> succ<span style=color:#f92672>[</span><span style=color:#66d9ef>zero</span>, <span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>two</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> succ<span style=color:#f92672>[</span><span style=color:#66d9ef>one</span>, <span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>

  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>plus</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>=&gt;&gt;</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>=&gt;&gt;</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#f92672>=&gt;&gt;</span> m<span style=color:#f92672>[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]]</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>+</span><span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#f92672>=&gt;&gt;</span> plus<span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>][</span><span style=color:#66d9ef>n</span><span style=color:#f92672>][</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>
  
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>times</span> <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>=&gt;&gt;</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#f92672>=&gt;&gt;</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#f92672>=&gt;&gt;</span> m<span style=color:#f92672>[[</span><span style=color:#66d9ef>z0</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=&gt;</span><span style=color:#66d9ef>&gt;</span> <span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z0</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>*</span><span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>n</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>_</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#f92672>=&gt;&gt;</span> times<span style=color:#f92672>[</span><span style=color:#66d9ef>m</span><span style=color:#f92672>][</span><span style=color:#66d9ef>n</span><span style=color:#f92672>][</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>

  <span style=color:#75715e>// use typeclasses to fold over the type structure
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Nat</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span><span style=color:#a6e22e>:</span>
    <span style=color:#66d9ef>def</span> real<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span>

  <span style=color:#66d9ef>trait</span> <span style=color:#a6e22e>Succ</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]</span>
  <span style=color:#a6e22e>trait</span> <span style=color:#a6e22e>Zero</span>

  given natForSucc<span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>](</span>using N<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Nat</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Nat</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Succ</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>]]</span> <span style=color:#66d9ef>with</span>
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> real<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> N<span style=color:#f92672>.</span>real <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>

  given natForZero<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Nat</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Zero</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>with</span>
    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>def</span> real<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>

  <span style=color:#66d9ef>def</span> real<span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>](</span>using N<span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Nat</span><span style=color:#f92672>[</span><span style=color:#66d9ef>T</span><span style=color:#f92672>])</span><span style=color:#66d9ef>:</span> <span style=color:#66d9ef>Int</span> <span style=color:#f92672>=</span>
    N<span style=color:#f92672>.</span>real
    
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>expr</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>one <span style=color:#f92672>+</span> one <span style=color:#f92672>+</span> one<span style=color:#f92672>)[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>
  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>expr2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>s</span><span style=color:#f92672>[</span><span style=color:#66d9ef>_</span><span style=color:#f92672>]</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span> <span style=color:#66d9ef>=</span> <span style=color:#f92672>(</span>expr <span style=color:#f92672>*</span> expr<span style=color:#f92672>)[</span><span style=color:#66d9ef>s</span>, <span style=color:#66d9ef>z</span><span style=color:#f92672>]</span>

  println<span style=color:#f92672>(</span>real<span style=color:#f92672>[</span><span style=color:#66d9ef>expr2</span><span style=color:#f92672>[</span><span style=color:#66d9ef>Succ</span>, <span style=color:#66d9ef>Zero</span><span style=color:#f92672>]])</span> <span style=color:#75715e>// 9
</span><span style=color:#75715e></span>  
<span style=color:#f92672>}</span>
</code></pre></div><p>It&rsquo;s been possible to write this out in Scala 2 for a long time
(see <a href=https://michid.wordpress.com/2008/04/18/meta-programming-with-scala-part-i-addition/>this post</a>),
but the presence of type lambdas in Scala 3 lets us defer some type application
until actually we need to &ldquo;perform evaluation&rdquo;, which makes for prettier and
more composable types.</p></article></main><footer id=footer>Copyright © 2020 Raas Ahsan</footer></body></html>